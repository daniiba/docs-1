---
sidebarTitle: 'Quick Start'
title: 'Quick Start'
icon: rocket
---

Here you will see how to implement the Mellowtel library in your extension project.
Estimated time to complete: 5-7 minutes.

# Requirements
Before you start, make sure that:

1) Your Chrome Extension is using [Manifest V3](https://developer.chrome.com/docs/extensions/develop/migrate/what-is-mv3)
2) Your code is organized in a compiled way, by using Webpack, Rollup, or other bundlers.
If you don't have a bundler set up, first follow the guide [here](https://docs.mellowtel.it/guides/static-to-webpack)

# Install npm package

To install the npm package, you can run the following command in your terminal:

```npm
npm install mellowtel
```

<Accordion title="Yarn">
    If you are using yarn as your package manager, you can run the following command:
    ```yarn
    yarn add mellowtel
    ```
</Accordion>

# Decide implementation
There are two ways you can implement the Mellowtel library in your extension.

If you are going to release the extension for the first time on the Web Store follow Option 1.
If you already have the extension published on the Web Store read "How to decide?"

### How to decide?

When you install your extension from the Web Store, does an alert window pop up asking for permission to "Read and change all your data on all websites"?

It looks like this:

<Frame caption="Alert window asking for permission to Read and change all your data on all websites">
    <img src="/images/alert_web_store.png" />
</Frame>

If it does, you can follow Option 1. If it doesn't, you need to follow Option 2.


# Option 1
If you are releasing the extension for the first time on the Web Store or you are importing the library in an extension that asks for permission to operate on all websites, you can follow Option 1.

### Set up your manifest
In your [manifest.json](https://developer.chrome.com/docs/extensions/reference/manifest) file modify the `permissions` and `host_permissions` sections like this:

```json

  "permissions": [
    "storage",
    "tabs",
    "declarativeNetRequest"
  ],
  "host_permissions": [
    "\u003Call_urls\u003E"
  ],

```

### Set up your service worker (background script)

In your [service worker](https://developer.chrome.com/docs/extensions/develop/concepts/service-workers) file, you need to import the `mellowtel` package.
Note: The service worker is also known as `background script`.

You can copy and paste the following code into your service worker file by changing the `configuration_key` with your own key.

```javascript
import Mellowtel from "mellowtel";
let mellowtel;
(async () => {
mellowtel = new Mellowtel("<configuration_key>");
await mellowtel.initBackground();
})();
```

<Accordion title="Service worker code breakdown">
Import the mellowtel package
```javascript
import Mellowtel from "mellowtel";
```

You can then use `Mellowtel(configuration_key, options?)` to create a new instance of the Mellowtel object. The Mellowtel object is your entrypoint to the rest of Mellowtel's SDK. Your `configuration_key` is required when calling this function, as it identifies your extension to Mellowtel. You can find your `configuration_key` in the [dashboard](https://www.mellowtel.it/mellowtel-dashboard/#home)
```javascript
mellowtel = new Mellowtel("<configuration_key>");
```

Initialize Mellowtel by calling the `initBackground` method. This method will initialize the Mellowtel object and set up the necessary listeners.
```javascript
await mellowtel.initBackground();
```
</Accordion>


### Set up your content script
You have to import the mellowtel package in [content scripts](https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts) as well.

This content script should run in `all_frames` and `<all_urls>` at the `document_start`.

We suggest creating a new content script (e.g. content_start_mellowtel.js) where you can copy and paste the following code.
Change the `configuration_key` with your own key.

    ```javascript
    import Mellowtel from "mellowtel";
    let mellowtel;
    (async () => {
    mellowtel = new Mellowtel("<configuration_key>"); //Change here with your configuration key
    await mellowtel.initContentScript();
    })();
    ```

Then remember to add also this content script in your `manifest.json` file in the content_scripts section alongside any other content script you already have.
You can copy and paste the following code by changing the `name_of_your_content_script.js` with the name you chose.

```json

  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["<name_of_your_content_script.js>"], //Change here with the name of your content script
      "run_at": "document_start",
      "all_frames": true
    }
]
```

### Set up opt-in/opt-out logic
In order to activate Mellowtel, users need to explicitly opt-in to the service.

You can implement the opt-in/opt-out logic in two ways:
1) Using the recommended implementation with the pre-built page provided by Mellowtel.

2) Creating your own custom opt-in/opt-out elements and using the methods shown [here](https://docs.mellowtel.it/concepts/opt-in-out#2-custom-elements)

If you use the recommended implementation, open your `service worker` file (also known as background script) and add the following code:

```javascript
chrome.runtime.onInstalled.addListener(async function(details) {
    console.log("Extension Installed or Updated");
    // If you want to handle first install and updates differently
    /**
    if(details.reason === "install"){
        // call a function to handle a first install
    } else if(details.reason === "update") {
        // call a function to handle an update
    }
    **/
    await mellowtel.generateAndOpenOptInLink();
});
```

Now you are ready to send your extension to the Web Store. Follow the guide here to see how to [submit your extension](https://docs.mellowtel.it/get-started/submit-to-Web-Store)

# Option 2

<Warning>Option 2 could potentially disable your extension if not implemented correctly. We recommend using [extension-update-testing-tool](https://github.com/GoogleChromeLabs/extension-update-testing-tool) to test before sending an update to the Web Store</Warning>

Use Option 2 only if you have already published your extension on the Web Store and you have asked for permission to operate only on specific websites.

### Set up your manifest

In your [manifest.json](https://developer.chrome.com/docs/extensions/reference/manifest) file modify the `permissions`, `optional_permissions` and `optional_host_permissions` sections like this

```json

  "permissions": [
    "storage",
    "scripting"
  ],
  "optional_permissions": [
    "tabs",
    "declarativeNetRequestWithHostAccess"
  ],
  "optional_host_permissions": [
    "https://*/*"
  ],

```
<Accordion title="Code breakdown">

</Accordion>


### Set up your service worker (background script)
In your [service worker](https://developer.chrome.com/docs/extensions/develop/concepts/service-workers) file, you need to import the `mellowtel` package.

Note: The service worker is also known as `background script`.

You can copy and paste the following code into your service worker file by changing the `configuration_key` with your own key.

```javascript
import Mellowtel from "mellowtel";
let mellowtel;
(async () => {
    mellowtel = new Mellowtel("<configuration_key>");
    await mellowtel.initBackground();
})();

chrome.permissions.onAdded.addListener(async (permissions) => {
    const scripts = await chrome.scripting.getRegisteredContentScripts();
    const mellowtelContentScript = scripts.find((script) => script.id === "mellowtel-content");
    if (permissions.origins?.includes("https://*/*")) {
      if (!mellowtelContentScript) {
        await chrome.scripting.registerContentScripts([{
          id: "mellowtel-content",
          js: ["mellowtel-content.js"],
          matches: ["<all_urls>"],
          runAt: "document_start",
          allFrames: true,
        }]);
      }
      const hasOptedIn = await mellowtel.getOptInStatus();
      if (hasOptedIn) {
        await mellowtel.start();
      }
    }
  });

chrome.runtime.onInstalled.addListener(async () => {
    // Dynamic content script gets cleared on update
    // https://groups.google.com/a/chromium.org/g/chromium-extensions/c/ZM0Vzb_vuIs
    chrome.scripting.unregisterContentScripts()
      .then(async () => {
        const permissions = await chrome.permissions.getAll();
        if (permissions.origins?.includes("https://*/*")) {
          await chrome.scripting.registerContentScripts([{
            id: "mellowtel-content",
            js: ["mellowtel-content.js"],
            matches: ["<all_urls>"],
            runAt: "document_start",
            allFrames: true,
          }]);
          const hasOptedIn = await mellowtel.getOptInStatus();
          if (hasOptedIn) {
            await mellowtel.start();
          }
        }
      });
  });
```

Here's a breakdown of the code above:
<Accordion title="Service worker code breakdown">
    Import the mellowtel package
    ```javascript
    import Mellowtel from "mellowtel";
    ```

    You can then use `Mellowtel(configuration_key, options?)` to create a new instance of the Mellowtel object. The Mellowtel object is your entrypoint to the rest of Mellowtel's SDK. Your `configuration_key` is required when calling this function, as it identifies your extension to Mellowtel. You can find your `configuration_key` in the [dashboard](https://www.mellowtel.it/mellowtel-dashboard/#home)
    ```javascript
    mellowtel = new Mellowtel("<configuration_key>");
    ```

    Initialize Mellowtel by calling the `initBackground` method. This method will initialize the Mellowtel object and set up the necessary listeners.
    ```javascript
    await mellowtel.initBackground();
    ```
</Accordion>


### Set up your content script
You have to import the mellowtel package in [content scripts](https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts) as well.

We suggest creating a new content script called `mellowtel-content.js` where you can copy and paste the following code.

This content script should run in `all_frames` and `<all_urls>` at the `document_start`.

Change the `configuration_key` with your own key that you can find in your [dashboard](https://www.mellowtel.it/mellowtel-dashboard)

    ```javascript
    import Mellowtel from "mellowtel";
    export default defineContentScript({
        matches: ["<all_urls>"],
        runAt: "document_start",
        allFrames: true,
        main: async () => {
            const mellowtel = new Mellowtel(<configuration_key>);
            await mellowtel.initContentScript();
        },
    });
    ```
Note:
We recommend using `mellowtel-content.js` as the name of the content script since it's the default implementation showed in this guide and you don't have to modify anything. But you can choose the name you like most. Just remember to be consistent and change also when you are setting up your `service worker` file in the section:

```javascript
    await chrome.scripting.registerContentScripts([{
        id: "name-of-your-content-script",
        js: ["name-of-your-content-script.js"],
        matches: ["<all_urls>"],
        runAt: "document_start",
        allFrames: true,
        }]);
    }
```

### Set up opt-in/opt-out logic
In order to activate Mellowtel, users need to explicitly opt-in to the service.

You can implement the opt-in/opt-out logic in two ways:
1) Using the recommended implementation with the pre-built page provided by Mellowtel.

2) Creating your own custom opt-in/opt-out elements and using the methods shown [here](https://docs.mellowtel.it/concepts/opt-in-out#2-custom-elements)

If you use the recommended implementation, open your `service worker` file (also known as background script) and add the following code:

```javascript
chrome.runtime.onInstalled.addListener(async function(details) {
    console.log("Extension Installed or Updated");
    // If you want to handle first install and updates differently
    /**
    if(details.reason === "install"){
        // call a function to handle a first install
    } else if(details.reason === "update") {
        // call a function to handle an update
    }
    **/
    await mellowtel.generateAndOpenOptInLink();
});
```

Now you are ready to send your extension to the Web Store. Follow the guide here to see how to [submit your extension](https://docs.mellowtel.it/get-started/submit-to-Web-Store)
